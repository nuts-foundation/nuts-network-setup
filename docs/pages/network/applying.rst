.. _join-a-network:

Joining a network
#################

At the moment of writing you can only participate in the network as a software vendor.

Joining as vendor
*****************

To join a network your node needs 2 certificates: one for the *Corda network* and one for the *Nuts network*. These
certificates are issued by the *Nuts Network Authority* (although currently the second one is still self-signed).
The bootstrap process looks as follows:

1. Generate Corda network Certificate Signing Request (CSR).
2. Submit Corda network CSR to Nuts Foundation and loading it into the Corda node.
3. Register vendor which generates a self-signed Nuts network certificate.
4. Restart the Nuts node for the changes to take effect (required for the certificate, generated by step 3 to be activated).

The diagram below illustrates the activities involved for step 3 and 4:

.. raw:: html
  :file: ../../_static/images/node-bootstrap-flow.svg

1. Generate Corda network CSR
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

To join the Corda network, your node needs a CA certificate so it can issue certificates to identify itself to other
Corda nodes. This CA certificate is issued by the Nuts Network Authority through a CSR. A Corda node can generate this CSR for you.
To do this, you'll need the following directory structure:

- NODE_BASE_DIR
    - node.conf
    - certificates/truststore.jks

A basic node.conf looks like this:

.. code-block:: yaml

    myLegalName="O=Nuts,C=NL,L=IJbergen,CN=node"
    emailAddress="info@nuts.nl"
    devMode=false
    networkServices {
        doormanURL = "http://discovery:8080/doorman"
        networkMapURL = "http://discovery:8080"
    }
    p2pAddress="your_p2p_address:7886"
    trustStorePassword="changeit"
    keyStorePassword="cordacadevpass"


It's important to change ``myLegalName``. Enter the correct password for the trustStore under ``trustStorePassword``, this should have been published next to the ``truststore.jks`` file. ``keyStorePassword`` should not be changed. The ``networkServices`` will not resolve but this is not an issue for now. All extra settings are not important for now.

The ``truststore.jks`` file has to be downloaded and placed in the certificates directory.

When you're happy with your config run:

.. code-block:: shell

    docker run -it \
        -v {{NODE_BASE_DIR}}/node.conf:/opt/nuts/node.conf \
        -v {{NODE_BASE_DIR}}/certificates:/opt/nuts/certificates \
        nutsfoundation/generate-csr:latest

where ``NODE_BASE_DIR`` points to the directory where the former files live.

.. note::

    After the creation of the CSR and before you run the node. The ``networkService`` part of the config has to be removed (while running without the discovery service). Also ``devMode`` should be set to true.

2. Submitting Corda network CSR
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

When the docker container finishes running a ``csr.pem`` file will have been placed in the ``NODE_BASE_DIR`` directory. Send this file to the Nuts foundation.

When you receive a zip package, you can continue with :ref:`loading-keys`.

3. Registering vendor
^^^^^^^^^^^^^^^^^^^^^

For a detailed guide on how to register your vendor, Please refer to :ref:`register-vendor-label`.